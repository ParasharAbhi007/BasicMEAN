template:
  name: newversion
  type: Step
  tags:
    aws: ""
  icon: data:image/jpeg;base64,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
  spec:
    timeout: 10m
    type: ShellScript
    spec:
      shell: Bash
      source:
        type: Inline
        spec:
          script: |-
            SHARED_DATA_DIR="/shared-data/<+org.identifier>/<+project.identifier>/<+pipeline.identifier>/<+pipeline.sequenceId>/runtime"

            if [ ! -f "$SHARED_DATA_DIR/stsconfig.json" ]; then
              echo "Error: This template is only designed to be used within the Deploy Stage type while using the 'AWS - Assume Role' Deployment template"
              exit 1
            fi

            cd "/shared-data/<+org.identifier>/<+project.identifier>/<+pipeline.identifier>/<+pipeline.sequenceId>/runtime"

            if [ ! -f "stsconfig.json" ]; then
              echo "Error: STS Configuration file not found!"
              exit 1
            fi 

            export AWS_ACCESS_KEY_ID="$(jq .Credentials.AccessKeyId --raw-output stsconfig.json)"
            export AWS_SECRET_ACCESS_KEY="$(jq .Credentials.SecretAccessKey --raw-output stsconfig.json)"
            export AWS_SESSION_TOKEN="$(jq .Credentials.SessionToken --raw-output stsconfig.json)"

            if [ "$?" -ne "0" ]; then
              rm stsconfig.json
              exit 1
            fi

            #remove credential files
            rm stsconfig.json
      environmentVariables: []
      outputVariables:
        - name: AWS_ACCESS_KEY_ID
          type: Secret
          value: AWS_ACCESS_KEY_ID
        - name: AWS_SECRET_ACCESS_KEY
          type: Secret
          value: AWS_SECRET_ACCESS_KEY
        - name: AWS_SESSION_TOKEN
          type: Secret
          value: AWS_SESSION_TOKEN
      executionTarget: {}
      delegateSelectors: []
  identifier: newversion
  versionLabel: "1.0"
